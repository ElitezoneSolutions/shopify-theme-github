{% comment %}
  Custom Flex Section using Shopify dynamic color variables.
  This section includes three block types:
    • Content Block (with up to three sets of heading & paragraph)
    • Image Block (image picker)
    • Video Block (with URL, autoplay, loop, muted, controls, and a selectable video ratio)

  The CSS uses Shopify’s native dynamic color variables (e.g. rgb(var(--color-background)) and rgb(var(--color-text))).
  Adjust the variable names if your theme uses different ones.
{% endcomment %}

<style>
  /* Section styling using Shopify dynamic color variables */
  .custom-flex-section {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
    padding: 20px;
    gap: 20px;
    max-width: 1200px;
    margin: auto;
    background-color: rgb(var(--color-background));
    color: rgb(var(--color-text));
  }
  .custom-flex-section .feature-content {
    flex: 1;
    min-width: 300px;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }
  .custom-flex-section .content {
    text-align: center;
  }
  .custom-flex-section .image-container {
    text-align: center;
    min-width: 300px;
  }
  .custom-flex-section .image-container img {
    width: 100%;
    max-width: 400px;
  }
  .custom-flex-section .video-container {
    text-align: center;
    min-width: 300px;
  }
  .custom-flex-section .video-container video {
    width: 100%;
    max-width: 400px;
    object-fit: cover;
  }
  @media (max-width: 767px) {
    .custom-flex-section .feature-content {
      flex-direction: row;
    }
  }
</style>

<div class="custom-flex-section">
  {% for block in section.blocks %}
    {% case block.type %}
      {% when 'content' %}
        <div class="feature-content">
          <div class="content">
            {% if block.settings.heading != blank %}
              <h3>{{ block.settings.heading }}</h3>
            {% endif %}
            {% if block.settings.paragraph != blank %}
              <p>{{ block.settings.paragraph }}</p>
            {% endif %}
            {% if block.settings.heading_2 != blank %}
              <h3>{{ block.settings.heading_2 }}</h3>
            {% endif %}
            {% if block.settings.paragraph_2 != blank %}
              <p>{{ block.settings.paragraph_2 }}</p>
            {% endif %}
            {% if block.settings.heading_3 != blank %}
              <h3>{{ block.settings.heading_3 }}</h3>
            {% endif %}
            {% if block.settings.paragraph_3 != blank %}
              <p>{{ block.settings.paragraph_3 }}</p>
            {% endif %}
          </div>
        </div>
      {% when 'image' %}
        <div class="image-container">
          {% if block.settings.image != blank -%}
            <img src="{{ block.settings.image | img_url: '600x400' }}" alt="Image">
          {%- endif %}
        </div>
      {% when 'video' %}
        {% assign ratio = block.settings.video_ratio | default: '16:9' %}
        <div class="video-container" style="aspect-ratio: {{ ratio | replace: ':', '/' }};">
          {% assign video_url = block.settings.video_url
            | default: 'https://cdn.shopify.com/videos/c/vp/dd0d65a8ee0b412187e96eec6a907150/dd0d65a8ee0b412187e96eec6a907150.HD-1080p-2.5Mbps-43033818.mp4'
          %}
          <video
            {% if block.settings.autoplay %}
              autoplay
            {% endif %}
            {% if block.settings.loop %}
              loop
            {% endif %}
            {% if block.settings.muted %}
              muted
            {% endif %}
            {% if block.settings.controls %}
              controls
            {% endif %}
          >
            <source src="{{ video_url }}" type="video/mp4">
            Your browser does not support the video tag.
          </video>
        </div>
    {% endcase %}
  {% endfor %}
</div>

{% schema %}
{
  "name": "Custom Flex Section",
  "settings": [],
  "blocks": [
    {
      "type": "content",
      "name": "Content Block",
      "settings": [
        { "type": "text", "id": "heading", "label": "Heading 1" },
        { "type": "richtext", "id": "paragraph", "label": "Paragraph 1" },
        { "type": "text", "id": "heading_2", "label": "Heading 2" },
        { "type": "richtext", "id": "paragraph_2", "label": "Paragraph 2" },
        { "type": "text", "id": "heading_3", "label": "Heading 3" },
        { "type": "richtext", "id": "paragraph_3", "label": "Paragraph 3" }
      ]
    },
    {
      "type": "image",
      "name": "Image Block",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Image" }
      ]
    },
    {
      "type": "video",
      "name": "Video Block",
      "settings": [
        { "type": "url", "id": "video_url", "label": "Video URL" },
        { "type": "checkbox", "id": "autoplay", "label": "Autoplay", "default": false },
        { "type": "checkbox", "id": "loop", "label": "Loop", "default": false },
        { "type": "checkbox", "id": "muted", "label": "Muted", "default": false },
        { "type": "checkbox", "id": "controls", "label": "Show Controls", "default": true },
        {
          "type": "select",
          "id": "video_ratio",
          "label": "Video Ratio",
          "options": [
            { "value": "16:9", "label": "16:9" },
            { "value": "4:3", "label": "4:3" },
            { "value": "1:1", "label": "1:1" },
            { "value": "21:9", "label": "21:9" }
          ],
          "default": "16:9"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Custom Flex Section",
      "category": "Custom"
    }
  ]
}
{% endschema %}
